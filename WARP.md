# WARP.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

## Project Overview

This is a Laravel 12 + Vue 3 + Inertia.js application using:
- **Backend**: Laravel 12 (PHP 8.2+) with Laravel Fortify for authentication
- **Frontend**: Vue 3 with TypeScript, Inertia.js for SPA-like experience
- **Styling**: Tailwind CSS v4
- **UI Components**: shadcn-vue (Reka UI) components in `resources/js/components/ui/`
- **Testing**: Pest (PHP) for backend tests
- **Database**: SQLite (default), supports MySQL/PostgreSQL
- **Build Tool**: Vite

## Development Commands

### Initial Setup
```bash
composer setup
# Runs: composer install, copies .env, generates key, runs migrations, npm install, npm run build
```

### Development Server
```bash
composer dev
# Starts: PHP server, queue worker, log tail (pail), and Vite dev server concurrently
```

### Development with SSR
```bash
composer dev:ssr
# Builds SSR bundle and starts all services including Inertia SSR
```

### Testing
```bash
composer test           # Run all tests
php artisan test        # Alternative way
php artisan test --filter=TestName  # Run specific test
```

### Frontend Commands
```bash
npm run dev             # Start Vite dev server (standalone)
npm run build           # Build for production
npm run build:ssr       # Build with SSR support
npm run lint            # Run ESLint with auto-fix
npm run format          # Format with Prettier
npm run format:check    # Check formatting
```

### Code Quality
```bash
./vendor/bin/pint       # Run Laravel Pint (PHP code style fixer)
npm run lint            # Run ESLint on TypeScript/Vue files
npm run format          # Format with Prettier
```

### Database
```bash
php artisan migrate              # Run migrations
php artisan migrate:fresh        # Drop all tables and re-run migrations
php artisan db:seed              # Run seeders
php artisan migrate:fresh --seed # Fresh database with seed data
```

### Other Useful Commands
```bash
php artisan tinker              # Interactive REPL
php artisan route:list          # List all routes
php artisan pail                # Tail application logs
php artisan queue:listen        # Start queue worker
php artisan serve               # Start development server (port 8000)
```

## Architecture

### Backend Structure

**Controllers** (`app/Http/Controllers/`)
- Organized by feature/domain (e.g., `Settings/ProfileController.php`)
- Return Inertia responses: `Inertia::render('PageName', $props)`
- Keep controllers thin; business logic goes in Actions or Services

**Actions** (`app/Actions/`)
- Laravel Fortify actions for authentication flows
- Custom business logic should be organized here

**Routes** (`routes/`)
- `web.php` - Main application routes
- `settings.php` - Settings-related routes (included in web.php)
- `console.php` - Artisan commands

**Models** (`app/Models/`)
- Eloquent ORM models
- User model includes Fortify's two-factor authentication traits

**Requests** (`app/Http/Requests/`)
- Form validation classes
- Example: `Settings/ProfileUpdateRequest.php`

### Frontend Structure

**Pages** (`resources/js/pages/`)
- Vue components rendered by Inertia
- Organized by feature (e.g., `settings/Profile.vue`, `Dashboard.vue`)
- Pages receive props from backend controllers

**Layouts** (`resources/js/layouts/`)
- `AppLayout.vue` - Main authenticated app layout
- `AuthLayout.vue` - Authentication pages layout
- Subdirectories for layout partials (`app/`, `auth/`, `settings/`)

**Components** (`resources/js/components/`)
- Custom application components (e.g., `AppHeader.vue`, `AppSidebar.vue`)
- `ui/` subdirectory contains shadcn-vue components (auto-generated, excluded from linting)

**Routes** (`resources/js/routes/`)
- Type-safe route helpers generated by Laravel Wayfinder
- `index.ts` exports route functions matching Laravel backend routes
- Usage: `import { dashboard } from '@/routes'` then `dashboard().url`

**Composables** (`resources/js/composables/`)
- Reusable Vue composition functions
- Example: `useAppearance.ts` for theme management

**Actions** (`resources/js/actions/`)
- Frontend form submission handlers and API interactions

**Types** (`resources/js/types/`)
- TypeScript type definitions
- Includes Inertia page props interfaces

### Key Patterns

**Inertia.js Flow**
1. Backend controller returns: `Inertia::render('PageName', ['prop' => $value])`
2. Frontend page receives props via `defineProps<{ prop: Type }>()`
3. Navigation uses `<Link>` component or `router.visit()` from `@inertiajs/vue3`

**Type-Safe Routing (Wayfinder)**
- Backend routes are auto-generated to `resources/js/routes/`
- Import and use: `dashboard().url`, `profile.edit().url`
- Supports query params: `route({ query: { key: 'value' } })`

**Layouts**
- Pages use layouts: `<AppLayout :breadcrumbs="breadcrumbs">...</AppLayout>`
- Layouts provide consistent structure with sidebar, header, footer

**UI Components**
- Use shadcn-vue components from `@/components/ui/`
- Styled with Tailwind utility classes
- Component variants managed by `class-variance-authority`

## Important Conventions

**Path Aliases** (defined in `tsconfig.json` and `components.json`)
- `@/` → `resources/js/`
- `@/components` → `resources/js/components`
- `@/layouts` → `resources/js/layouts`
- `@/composables` → `resources/js/composables`
- `@/lib` → `resources/js/lib`
- `@/ui` → `resources/js/components/ui`

**Authentication**
- Powered by Laravel Fortify
- Two-factor authentication supported
- Auth routes in `vendor/laravel/fortify` (auto-registered)
- Custom auth logic in `app/Actions/Fortify/`

**Testing**
- Use Pest syntax for all tests
- Feature tests in `tests/Feature/`
- Unit tests in `tests/Unit/`
- Test structure defined in `tests/Pest.php`

**Code Style**
- PHP: Laravel Pint (PSR-12 based)
- TypeScript/Vue: ESLint + Prettier
- Vue components: Multi-word names rule disabled
- UI components excluded from linting

**Environment**
- Copy `.env.example` to `.env` for local setup
- SQLite by default (`database/database.sqlite`)
- Queue connection: database
- Mail: log driver (for development)

## Technology-Specific Notes

**Laravel Wayfinder**
- Automatically syncs Laravel routes to TypeScript
- Generates type-safe route helpers in `resources/js/routes/`
- Supports form variants with validation

**Inertia SSR**
- Entry point: `resources/js/ssr.ts`
- Build: `npm run build:ssr`
- Start: `php artisan inertia:start-ssr`

**Tailwind CSS v4**
- Uses `@tailwindcss/vite` plugin
- Config managed via CSS variables
- Base color: neutral

**Concurrently**
- Used in `composer dev` to run multiple processes
- Colorized output for server, queue, logs, and vite

## AI Development with Laravel Boost

This project uses Laravel Boost to provide AI agents with contextual understanding.

### Available MCP Tools

- `search-docs` - Search Laravel ecosystem documentation
- `tinker` - Execute PHP code in application context
- `database-query` - Query database directly
- `list-artisan-commands` - List available Artisan commands
- `browser-logs` - Read frontend error logs
- Full list: `php artisan boost:mcp --help`

### Custom Guidelines Location

Project-specific AI guidelines are in `.ai/guidelines/camr/` and include:

- Domain knowledge (meter infrastructure hierarchy)
- Feature documentation (data imports, analytics, site filtering)
- Testing patterns
- Frontend conventions
- Architecture patterns

### Updating Guidelines

Run `php artisan boost:update` to refresh Laravel ecosystem guidelines after package updates.
